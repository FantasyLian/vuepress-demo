# JS常用方法

## Javascript 的一些优化

1. 使用局部变量避免使用全局变量

   ```javascript
   function test() {
     var s = document.getElementById('aaa');
     s.innerHTML = document.body.clientHeight;
   }
   // 改为：
   function test() {
     var d = document;
     s = d.getElementById('aaa');
     s.innerHTML = d.body.clientHeight;
   }
   ```

2. 避免使用 with

   ```javascript
   function test() {
     with (document.body) {
       clientHeight = '200px';
       clientWidth = '200px';
     }
   }
   // 改为：
   function test() {
     var ds = document.body;
     ds.clientHeight = '200px';
     ds.clientWidth = '200px';
   }
   ```

3. 少用 var， 一个 var 加逗号

   ```javascript
   var a = 1;
   var b = 2;
   var c = 3;
   // 可以这样写：
   var a = 1,
     b = 2,
     c = 3;
   ```

4. 为多个同级元素绑定事件时，不用为每个都绑定，为它们的父级元素绑定就行了

   ```vue
   <template>
     <ul id='a'>
       <li>aaaaaaa</li>
       <li>bbbbbbb</li>
       <li>ccccccc</li>
     </ul>
   </template>
   <script>
   // 要为每个 li 添加 click事件，只要为ul添加就行了，因为事件是向上冒泡的。
   var ul = document.getElementById('a');
   ul.onclick = function () {
     !e && (e = event);
     var target = e.srcElement || e.target;
     if (target.tagName == 'li') {
       // do something
     }
   };
   </script>
   ```

5. appendChild 用的多时一定要用 documentFragment

   ```javascript
   for (var i = 0; i < 1000; i++) {
     var o = document.createElement('div');
     document.body.appendChild(o);
   }
   // 用 documentFragment:
   var f = document.createDocumentFragment();
   for (var i = 0; i < 1000; i++) {
     var o = document.createElement('div');
     f.appendChild(o);
   }
   document.body.appendChild(f);
   ```

6. if else 用的用法

   > `if else` >= 3 个，就用 `switch`; `if else` <= 3 个，用三元表达式; `if else` == 1, if 改 `&&`

   ```javascript
   if (a === 1) {
     a = 2;
   }
   // 改为：
   a === 1 && (a = 2);
   ```

## “星期几”的几种不同写法

- 第一种

  ```javascript
  const str = '';
  const week = new Date().getDay();
  if (week == 0) {
    str = '今天是星期日';
  } else if (week == 1) {
    str = '今天是星期一';
  } else if (week == 2) {
    str = '今天是星期二';
  } else if (week == 3) {
    str = '今天是星期三';
  } else if (week == 4) {
    str = '今天是星期四';
  } else if (week == 5) {
    str = '今天是星期五';
  } else if (week == 6) {
    str = '今天是星期六';
  }
  console.log(str);
  ```

- 第二种

  ```javascript
  const str = '今天是星期';
  const week = new Date().getDay();
  switch (week) {
    case 0:
      str1 += '日';
      break;
    case 1:
      str1 += '一';
      break;
    case 2:
      str1 += '二';
      break;
    case 3:
      str1 += '三';
      break;
    case 4:
      str1 += '四';
      break;
    case 5:
      str1 += '五';
      break;
    case 6:
      str1 += '六';
      break;
  }
  console.log(str);
  ```

- 第三种

  ```javascript
  const a = new Array('日', '一', '二', '三', '四', '五', '六');
  const week = new Date().getDay();
  const str = '今天是星期' + a[week];
  console.log(str);
  ```

- 第四种

  ```javascript
  const str = '今天是星期' + '日一二三四五六'.charAt(new Date().getDay());
  console.log(str);
  ```

## 数组操作

- 生成数组
  > 生成一个0-99的数组
  - 方案1:

    ```javascript
    const createArr = n => Array.from(new Array(n), (v, i) => i)
    const arr = createArr(100) // 0 - 99 数组
    ```

  - 方案2:

    ```javascript
    const createArr = n => new Array(n).fill(0).map((v, i) => i)
    createArr(100) // 0 - 99数组
    ```

- 打乱数组

  ```javascript
  const randomSort = list => list.sort(() => Math.random() - 0.5);
  randomSort([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]); // 随机排列结果

- 数组去重

  - 简单数据去重（将数组中所有重复的元素只保留一个）

    ```javascript
    const removeDuplicates = list => [...new Set(list)];
    const arr = [0, 0, 2, 4, 5];
    removeDuplicates(arr);
    // [0,2,4,5]
    ```

  - 唯一值数据去重（根据唯一值对数组进行去重）

    ```javascript
    const duplicateById = list => [
      ...list.reduce((prev, cur) => prev.set(cur.id, cur), new Map()).values()
    ];
    const arr = [
      { id: 1, name: 'jack' },
      { id: 2, name: 'rose' },
      { id: 1, name: 'jack' }
    ]
    duplicateById(arr);
    // [{id: 1, name: 'jack'}, {id: 2, name: 'rose'}]
    ```

- 多数组取交集

  > 取多个数组中共同的元素即取交集

  ```javascript
  const intersection = (a, ...arr) =>
    [...new Set(a)].filter((v) => arr.every((b) => b.includes(v)));
  const arr1 = [1, 2, 3, 4]
  const arr2 = [2, 3, 4, 7, 8]
  const arr3 = [1, 3, 4, 9]
  intersection(arr1, arr2, arr3);
  // [3, 4]
  ```

- 数组查找

  - 查找最大值索引

    > 找到一个数组中最大值的索引

    ```javascript
    const indexOfMax = arr =>
      arr.reduce((prev, current, i, a) => (current > a[prev] ? i : prev), 0);
    indexOfMax([1, 3, 9, 7, 5]); // 2
    ```

  - 查找最小值索引

    > 找到数组中最小值的索引

    ```javascript
    const indexOfMin = arr =>
      arr.reduce((prev, current, i, a) => (current < a[prev] ? i : prev), 0);
    indexOfMin([2, 5, 3, 4, 1, 0, 9]); // 5
    ```

  - 找到最接近的数值

    > 在数组中找到最接近的值

    ```javascript
    const closest = (arr, n) =>
      arr.reduce((prev, current) =>
        Math.abs(current - n) < Math.abs(prev - n) ? current : prev
      );
    closest([29, 87, 8, 78, 97, 20, 75, 33, 24, 17], 50); // 33
    ```

- 压缩多个数组

  > 将多个数组压缩成一个数组

  ```javascript
  const zip = (...arr) =>
    Array.from({ length: Math.max(...arr.map((a) => a.length)) }, (_, i) =>
      arr.map((a) => a[i])
    );
  const arr1 = [1, 2, 3, 4]
  const arr2 = ['a', 'b', 'c', 'd']
  const arr3 = ['A', 'B', 'C', 'D']
  zip(arr1, arr2, arr3);
  // [[1, 'a', 'A'], [2, 'b', 'B'], [3, 'c', 'C'], [4, 'd', 'D']]
  ```

- 矩阵交换行和列

  ```javascript
  const transpose = matrix => matrix[0].map((col, i) => matrix.map((row) => row[i]));
  transpose(
    [
                  //  [
      [1, 2, 3],  //    [1, 4, 7],
      [4, 5, 6],  //    [2, 5, 8],
      [7, 8, 9]   //    [3, 6, 9],
    ]             //  ]
  );
  ```
